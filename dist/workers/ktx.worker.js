(()=>{"use strict";var r={119:(t,e,r)=>{r.d(e,{q:()=>s});const s="0.0.3"}},s={};function M(t){var e=s[t];if(void 0!==e)return e.exports;e=s[t]={exports:{}};return r[t](e,e.exports,M),e.exports}M.d=(t,e)=>{for(var r in e)M.o(e,r)&&!M.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},M.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);(()=>{var i=M(119);class t{constructor(t,e,r){const s=this;let i=!1,n=0,o=0,a=void 0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){o++,!1===i&&void 0!==s.onStart&&s.onStart(t,n,o),i=!0},this.itemEnd=function(t){n++,void 0!==s.onProgress&&s.onProgress(t,n,o),n===o&&(i=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(t){void 0!==s.onError&&s.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){t=h.indexOf(t);return-1!==t&&h.splice(t,2),this},this.getHandler=function(r){for(let t=0,e=h.length;t<e;t+=2){const i=h[t];var s=h[t+1];if(i.global&&(i.lastIndex=0),i.test(r))return s}return null}}}const e=new t,m={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class r{constructor(t){this.manager=void 0!==t?t:e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,s){const i=this;return new Promise(function(t,e){i.load(r,t,s,e)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const p={};class o extends r{constructor(t){super(t)}load(a,r,e,s){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const h=this,t=m.get(a);if(void 0!==t)return h.manager.itemStart(a),setTimeout(function(){r&&r(t),h.manager.itemEnd(a)},0),t;if(void 0===p[a]){var i=a.match(/^data:(.*?)(;base64)?,(.*)$/);let t;if(i){var n=i[1],o=!!i[2];let e=i[3];e=decodeURIComponent(e),o&&(e=atob(e));try{let t;var d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":const c=new Uint8Array(e.length);for(let t=0;t<e.length;t++)c[t]=e.charCodeAt(t);t="blob"===d?new Blob([c.buffer],{type:n}):c.buffer;break;case"document":const u=new DOMParser;t=u.parseFromString(e,n);break;case"json":t=JSON.parse(e);break;default:t=e}setTimeout(function(){r&&r(t),h.manager.itemEnd(a)},0)}catch(t){setTimeout(function(){s&&s(t),h.manager.itemError(a),h.manager.itemEnd(a)},0)}}else{p[a]=[],p[a].push({onLoad:r,onProgress:e,onError:s}),t=new XMLHttpRequest,t.open("GET",a,!0),t.addEventListener("load",function(r){var s=this.response,i=p[a];if(delete p[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),m.add(a,s);for(let t=0,e=i.length;t<e;t++){const n=i[t];n.onLoad&&n.onLoad(s)}h.manager.itemEnd(a)}else{for(let t=0,e=i.length;t<e;t++){const o=i[t];o.onError&&o.onError(r)}h.manager.itemError(a),h.manager.itemEnd(a)}},!1),t.addEventListener("progress",function(r){var s=p[a];for(let t=0,e=s.length;t<e;t++){const i=s[t];i.onProgress&&i.onProgress(r)}},!1),t.addEventListener("error",function(r){var s=p[a];delete p[a];for(let t=0,e=s.length;t<e;t++){const i=s[t];i.onError&&i.onError(r)}h.manager.itemError(a),h.manager.itemEnd(a)},!1),t.addEventListener("abort",function(r){var s=p[a];delete p[a];for(let t=0,e=s.length;t<e;t++){const i=s[t];i.onError&&i.onError(r)}h.manager.itemError(a),h.manager.itemEnd(a)},!1),void 0!==this.responseType&&(t.responseType=this.responseType),void 0!==this.withCredentials&&(t.withCredentials=this.withCredentials),t.overrideMimeType&&t.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const l in this.requestHeader)t.setRequestHeader(l,this.requestHeader[l]);t.send(null)}return h.manager.itemStart(a),t}p[a].push({onLoad:r,onProgress:e,onError:s})}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}const n=[];for(let t=0;t<256;t++)n[t]=(t<16?"0":"")+t.toString(16);Math.PI,Math.PI;function c(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0;const i=n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&e]+n[e>>8&255]+"-"+n[e>>16&15|64]+n[e>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&s]+n[s>>8&255]+n[s>>16&255]+n[s>>24&255];return i.toUpperCase()}class u{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){var e=this.x,r=this.y,t=t.elements;return this.x=t[0]*e+t[3]*r+t[6],this.y=t[1]*e+t[4]*r+t[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){var r=Math.cos(e),s=Math.sin(e),i=this.x-t.x,e=this.y-t.y;return this.x=i*r-e*s+t.x,this.y=i*s+e*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}u.prototype.isVector2=!0;class l{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,r,s,i,n,o,a,h){const d=this.elements;return d[0]=t,d[1]=s,d[2]=o,d[3]=e,d[4]=i,d[5]=a,d[6]=r,d[7]=n,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements;t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var r=t.elements,s=e.elements;const i=this.elements;var n=r[0],o=r[3],a=r[6],h=r[1],d=r[4],c=r[7],u=r[2],l=r[5],m=r[8],p=s[0],f=s[3],y=s[6],g=s[1],x=s[4],t=s[7],e=s[2],r=s[5],s=s[8];return i[0]=n*p+o*g+a*e,i[3]=n*f+o*x+a*r,i[6]=n*y+o*t+a*s,i[1]=h*p+d*g+c*e,i[4]=h*f+d*x+c*r,i[7]=h*y+d*t+c*s,i[2]=u*p+l*g+m*e,i[5]=u*f+l*x+m*r,i[8]=u*y+l*t+m*s,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){var t=this.elements,e=t[0],r=t[1],s=t[2],i=t[3],n=t[4],o=t[5],a=t[6],h=t[7],t=t[8];return e*n*t-e*o*h-r*i*t+r*o*a+s*i*h-s*n*a}invert(){const t=this.elements,e=t[0],r=t[1],s=t[2],i=t[3],n=t[4],o=t[5],a=t[6],h=t[7],d=t[8],c=d*n-o*h,u=o*a-d*i,l=h*i-n*a,m=e*c+r*u+s*l;if(0==m)return this.set(0,0,0,0,0,0,0,0,0);var p=1/m;return t[0]=c*p,t[1]=(s*h-d*r)*p,t[2]=(o*r-s*n)*p,t[3]=u*p,t[4]=(d*e-s*a)*p,t[5]=(s*i-o*e)*p,t[6]=l*p,t[7]=(r*a-h*e)*p,t[8]=(n*e-r*i)*p,this}transpose(){var t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,s,i,n,o){var a=Math.cos(i),i=Math.sin(i);return this.set(r*a,r*i,-r*(a*n+i*o)+n+t,-s*i,s*a,-s*(-i*n+a*o)+o+e,0,0,1),this}scale(t,e){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this}rotate(t){var e=Math.cos(t),r=Math.sin(t);const s=this.elements;var i=s[0],n=s[3],o=s[6],a=s[1],h=s[4],t=s[7];return s[0]=e*i+r*a,s[3]=e*n+r*h,s[6]=e*o+r*t,s[1]=-r*i+e*a,s[4]=-r*n+e*h,s[7]=-r*o+e*t,this}translate(t,e){const r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this}equals(t){var e=this.elements,r=t.elements;for(let t=0;t<9;t++)if(e[t]!==r[t])return!1;return!0}fromArray(e,r=0){for(let t=0;t<9;t++)this.elements[t]=e[t+r];return this}toArray(t=[],e=0){var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}l.prototype.isMatrix3=!0;let s;class a{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=t.width,s.height=t.height;const r=s.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=s}return 2048<e.width||2048<e.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let f=0;class y extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){const r=this._listeners[t];void 0===r||-1!==(e=r.indexOf(e))&&r.splice(e,1)}}dispatchEvent(r){if(void 0!==this._listeners){const t=this._listeners[r.type];if(void 0!==t){r.target=this;const s=t.slice(0);for(let t=0,e=s.length;t<e;t++)s[t].call(this,r);r.target=null}}}}{constructor(t=y.DEFAULT_IMAGE,e=y.DEFAULT_MAPPING,r=1001,s=1001,i=1006,n=1008,o=1023,a=1009,h=1,d=3e3){super(),Object.defineProperty(this,"id",{value:f++}),this.uuid=c(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=r,this.wrapT=s,this.magFilter=i,this.minFilter=n,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new u(0,0),this.repeat=new u(1,1),this.center=new u(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new l,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const s=this.image;if(void 0===s.uuid&&(s.uuid=c()),!e&&void 0===t.images[s.uuid]){let r;if(Array.isArray(s)){r=[];for(let t=0,e=s.length;t<e;t++)s[t].isDataTexture?r.push(h(s[t].image)):r.push(h(s[t]))}else r=h(s);t.images[s.uuid]={uuid:s.uuid,url:r}}r.image=s.uuid}return e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function h(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?a.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}y.DEFAULT_IMAGE=void 0,y.DEFAULT_MAPPING=300,y.prototype.isTexture=!0;class d extends y{constructor(t,e,r,s,i,n,o,a,h,d,c,u){super(null,n,o,a,h,d,s,i,c,u),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}d.prototype.isCompressedTexture=!0;class g{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const r=this.workersResolve[t];if(r&&r(e),this.queue.length){const{resolve:r,msg:e,transfer:s}=this.queue.shift();this.workersResolve[t]=r,this.workers[t].postMessage(e,s)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(r,s){return new Promise(t=>{var e=this._getIdleWorker();-1!==e?(this._initWorker(e),this.workerStatus|=1<<e,this.workersResolve[e]=t,this.workers[e].postMessage(r,s)):this.queue.push({resolve:t,msg:r,transfer:s})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const x=new WeakMap;class T extends r{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new g,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}init(){if(!this.transcoderPending){const r=new o(this.manager);r.setPath(this.transcoderPath),r.setWithCredentials(this.withCredentials);var t=r.loadAsync("basis_transcoder.js");const s=new o(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);var e=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,e]).then(([t,e])=>{const r=T.BasisWorker.toString();t=["/* constants */","let _EngineFormat = "+JSON.stringify(T.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(T.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(T.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([t])),this.transcoderBinary=e,this.workerPool.setWorkerCreator(()=>{const t=new Worker(this.workerSourceURL);var e=this.transcoderBinary.slice(0);return t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:e},[e]),t})})}return this.transcoderPending}load(t,r,e,s){const i=new o(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=new d;return i.load(t,t=>{if(x.has(t)){const e=x.get(t);return e.promise.then(r).catch(s)}this._createTexture([t]).then(function(t){n.copy(t),n.needsUpdate=!0,r&&r(n)}).catch(s)},e,s),n}createTextureFrom(t){var{mipmaps:e,width:r,height:s,format:i,type:n,error:o,dfdTransferFn:a,dfdFlags:t}=t;if("error"===n)return Promise.reject(o);const h=new d(e,r,s,i,1009);return h.minFilter=1===e.length?1006:1008,h.magFilter=1006,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=2===a?3001:3e3,h.premultiplyAlpha=!!(1&t),h}_createTexture(t,e={}){const r=e;e=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:t,taskConfig:r},t)).then(t=>this.createTextureFrom(t.data));return x.set(t[0],{promise:e}),e}dispose(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),this}}T.BasisFormat={ETC1S:0,UASTC_4x4:1},T.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},T.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},T.BasisWorker=function(){let p,r,f;const y=_EngineFormat,g=_TranscoderFormat,x=_BasisFormat;self.addEventListener("message",function(t){const h=t.data;switch(h.type){case"init":p=h.config,e=h.transcoderBinary,r=new Promise(t=>{f={wasmBinary:e,onRuntimeInitialized:t},BASIS(f)}).then(()=>{f.initializeBasis(),void 0===f.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":r.then(()=>{try{var{width:t,height:e,hasAlpha:r,mipmaps:s,format:i,dfdTransferFn:n,dfdFlags:o}=function(t){const e=new f.KTX2File(new Uint8Array(t));function r(){e.close(),e.delete()}if(!e.isValid())throw r(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");var s=e.isUASTC()?x.UASTC_4x4:x.ETC1S,i=e.getWidth(),n=e.getHeight(),o=e.getLevels(),a=e.getHasAlpha(),h=e.getDFDTransferFunc(),t=e.getDFDFlags(),{transcoderFormat:d,engineFormat:s}=function(e,r,s,i){let n,o;var a=e===x.ETC1S?T:w;for(let t=0;t<a.length;t++){const h=a[t];if(p[h.if]&&(h.basisFormat.includes(e)&&(!h.needsPowerOfTwo||_(r)&&_(s))))return n=h.transcoderFormat[i?1:0],o=h.engineFormat[i?1:0],{transcoderFormat:n,engineFormat:o}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),n=g.RGBA32,o=y.RGBAFormat,{transcoderFormat:n,engineFormat:o}}(s,i,n,a);if(!i||!n||!o)throw r(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!e.startTranscoding())throw r(),new Error("THREE.KTX2Loader: .startTranscoding failed");const c=[];for(let t=0;t<o;t++){var u=e.getImageLevelInfo(t,0,0),l=u.origWidth,m=u.origHeight,u=new Uint8Array(e.getImageTranscodedSizeInBytes(t,0,0,d));if(!e.transcodeImage(u,t,0,0,d,0,-1,-1))throw r(),new Error("THREE.KTX2Loader: .transcodeImage failed.");c.push({data:u,width:l,height:m})}return r(),{width:i,height:n,hasAlpha:a,mipmaps:c,format:s,dfdTransferFn:h,dfdFlags:t}}(h.buffers[0]);const a=[];for(let t=0;t<s.length;++t)a.push(s[t].data.buffer);self.postMessage({type:"transcode",id:h.id,width:t,height:e,hasAlpha:r,mipmaps:s,format:i,dfdTransferFn:n,dfdFlags:o},a)}catch(t){console.error(t),self.postMessage({type:"error",id:h.id,error:t.message})}})}var e});const t=[{if:"astcSupported",basisFormat:[x.UASTC_4x4],transcoderFormat:[g.ASTC_4x4,g.ASTC_4x4],engineFormat:[y.RGBA_ASTC_4x4_Format,y.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[x.ETC1S,x.UASTC_4x4],transcoderFormat:[g.BC7_M5,g.BC7_M5],engineFormat:[y.RGBA_BPTC_Format,y.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[x.ETC1S,x.UASTC_4x4],transcoderFormat:[g.BC1,g.BC3],engineFormat:[y.RGB_S3TC_DXT1_Format,y.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[x.ETC1S,x.UASTC_4x4],transcoderFormat:[g.ETC1,g.ETC2],engineFormat:[y.RGB_ETC2_Format,y.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[x.ETC1S,x.UASTC_4x4],transcoderFormat:[g.ETC1,g.ETC1],engineFormat:[y.RGB_ETC1_Format,y.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[x.ETC1S,x.UASTC_4x4],transcoderFormat:[g.PVRTC1_4_RGB,g.PVRTC1_4_RGBA],engineFormat:[y.RGB_PVRTC_4BPPV1_Format,y.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],T=t.sort(function(t,e){return t.priorityETC1S-e.priorityETC1S}),w=t.sort(function(t,e){return t.priorityUASTC-e.priorityUASTC});function _(t){return t<=2||0==(t&t-1)&&0!==t}};var w=new t;const _=new T(w),v=new o(w),E={init:function(t){(function(t){_.setTranscoderPath(t.basisUrl),_.workerConfig=t.workerConfig,_.setWorkerLimit(t.basisWorkersNum||4),v.setResponseType("arraybuffer"),t.withCredentials&&(_.setWithCredentials(t.withCredentials),v.setWithCredentials(_.withCredentials))})(t.options),C({},t)},load:function(h){h.url?v.load(h.url,t=>{_.init().then(()=>_.workerPool.postMessage({type:"transcode",buffers:[t],taskConfig:{}},[t])).then(t=>{var{mipmaps:e,width:r,height:s,format:i,type:n,error:o,dfdTransferFn:a,dfdFlags:t}=t.data;C({mipmaps:e,width:r,height:s,format:i,type:n,error:o,dfdTransferFn:a,dfdFlags:t},h)}).catch(t=>{C({type:"error"},h,t.message)})},void 0,t=>C({type:"error"},h,"KTX Error")):postMessage({id:h.id,action:h.action,gltf:null,error:"Missing Resource URL"})},dispose:function(t){_.dispose(),C({},t)}};function C(t,e,r=[],s=null){postMessage({id:e.id,action:e.action,error:s,version:i.q,...t},r)}addEventListener("message",function(t){t=t.data;E.hasOwnProperty(t.action)?E[t.action](t):C({},t,[],"Missing action")})})()})();